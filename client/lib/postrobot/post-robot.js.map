{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap e8bcbf68075f383ae0e3","webpack:///./src/conf/index.js","webpack:///./src/lib/index.js","webpack:///./src/global.js","webpack:///./src/drivers/index.js","webpack:///./src/lib/util.js","webpack:///./src/interface/index.js","webpack:///./~/sync-browser-mocks/src/promise.js","webpack:///./src/lib/windows.js","webpack:///./src/bridge/index.js","webpack:///./src/bridge/common.js","webpack:///./src/lib/log.js","webpack:///./src/compat/index.js","webpack:///./src/conf/constants.js","webpack:///./src/drivers/listeners.js","webpack:///./src/drivers/send/index.js","webpack:///./src/lib/cleanup.js","webpack:///./src/lib/promise.js","webpack:///./src/lib/tick.js","webpack:///./src/bridge/bridge.js","webpack:///./src/bridge/child.js","webpack:///./src/bridge/parent.js","webpack:///./src/compat/ie.js","webpack:///./src/conf/config.js","webpack:///./src/drivers/receive/index.js","webpack:///./src/drivers/receive/types.js","webpack:///./src/drivers/send/strategies.js","webpack:///./src/interface/client.js","webpack:///./src/interface/config.js","webpack:///./src/interface/server.js","webpack:///./src/lib/methods.js","webpack:///./src/lib/ready.js","webpack:///./src/index.js"],"names":["global","window","WINDOW_PROPS","POSTROBOT","clean","registerSelf","util","once","method","called","onceWrapper","apply","arguments","noop","safeHasProp","obj","name","err","safeGetProp","listen","win","event","handler","addEventListener","attachEvent","cancel","removeEventListener","detachEvent","context","args","find","collection","def","i","length","map","results","push","some","Boolean","keys","mapping","result","key","hasOwnProperty","values","getByValue","value","uniqueID","chars","replace","charAt","Math","floor","random","memoize","memoized","JSON","stringify","Array","prototype","slice","call","extend","source","each","callback","isArray","replaceObject","depth","Error","newobj","item","undefined","safeInterval","time","timeout","runInterval","setTimeout","clearTimeout","intervalTimeout","interval","getDomain","mockDomain","indexOf","MOCK_PROTOCOL","location","protocol","FILE_PROTOCOL","host","getDomainFromUrl","url","domain","match","split","join","safeGet","prop","openBridge","linkUrl","isBridge","needsBridge","needsBridgeForBrowser","needsBridgeForWin","needsBridgeForDomain","openTunnelToOpener","destroyBridges","windowUtil","parent","winutil","patchPromise","trycatch","successHandler","errorHandler","isCalled","isSuccess","isError","res","flush","error","possiblyUnhandledPromiseHandlers","possiblyUnhandledPromises","possiblyUnhandledPromiseTimeout","addPossiblyUnhandledPromise","promise","flushPossiblyUnhandledPromises","promises","silentReject","handlers","onError","dispatchError","dispatch","dispatchedErrors","j","toString","isPromise","Window","constructor","then","Function","SyncPromise","resolved","rejected","self","resolve","reject","SyncPromiseResolve","asyncReject","shift","onSuccess","all","count","prom","onPossiblyUnhandledException","syncPromiseOnPossiblyUnhandledException","syncPromiseTry","delay","syncPromiseDelay","hash","promisifyCall","Promise","isSameDomain","getOpener","getParent","getParents","isAncestorParent","getFrames","getAllChildFrames","getAllFramesInWindow","getTop","isWindowClosed","getUserAgent","getFrameByName","findChildFrameByName","findFrameByName","isParent","isOpener","getAncestor","getAncestors","isAncestor","isPopup","isIframe","isFullpage","getWindowType","isSameTopWindow","jsonStringify","jsonParse","domainMatches","domainMatchTimeout","opener","child","childParent","frames","len","frame","childFrame","top","allowMock","closed","message","navigator","mockUserAgent","userAgent","winFrames","namedFrame","frameParent","ancestor","actualParent","WINDOW_TYPES","POPUP","IFRAME","FULLPAGE","anyMatch","collection1","collection2","item1","item2","win1","win2","top1","top2","allFrames1","allFrames2","opener1","opener2","objectToJSON","arrayToJSON","Object","toJSON","parse","getBridgeName","registerRemoteWindow","findRemoteWindow","registerRemoteSendMessage","rejectRemoteSendMessage","sendBridgeMessage","ALLOW_POSTMESSAGE_POPUP","sanitizedDomain","id","BRIDGE_NAME_PREFIX","documentBodyReady","document","body","setInterval","clearInterval","remoteWindows","BRIDGE_TIMEOUT","sendMessagePromise","sendMessage","remoteWindow","sendMessageWrapper","remoteWin","remoteDomain","messagingChild","messagingParent","receiveMessage","LOG_LEVELS","bind","console","log","forEach","clearLogs","clear","LOG_TO_PAGE","container","getElementById","parentNode","removeChild","writeToPage","level","createElement","style","cssText","appendChild","el","date","Date","payload","json","e","msg","innerHTML","color","warn","info","debug","childNodes","insertBefore","logLevel","LOG_LEVEL","unshift","pathname","toLowerCase","CONSTANTS","POST_MESSAGE_TYPE","REQUEST","RESPONSE","ACK","POST_MESSAGE_ACK","SUCCESS","ERROR","POST_MESSAGE_NAMES","METHOD","READY","OPEN_TUNNEL","SERIALIZATION_TYPES","SEND_STRATEGIES","POST_MESSAGE","BRIDGE","GLOBAL","POSTROBOT_PROXY","POST_MESSAGE_NAMES_LIST","resetListeners","getRequestListener","removeRequestListener","addRequestListener","listeners","request","response","isRegex","matchDomain","origin","requestListener","specifiedWin","specifiedDomain","matchedWin","matchedDomain","options","listener","splice","override","buildMessage","type","sourceDomain","windowType","run","data","ack","MOCK_MODE","target","postMessage","messages","serializedMessage","ALLOWED_POST_MESSAGE_METHODS","strategyName","stack","success","status","cleanup","tasks","getters","array","object","set","register","index","setItem","complete","hasTasks","filter","pop","toClean","nextTick","promiseWrapper","nodeify","deNodeify","items","tickMessageName","queue","openTunnelToParent","canary","getRemoteBridgeForWindow","bridge","bridges","listenForRegister","winDetails","popupWindows","openBridgeFrame","iframe","setAttribute","src","contentWindow","onload","onerror","windowOpen","open","last","winOptions","emulateIERestrictions","sourceWindow","targetWindow","CONFIG","__TEST__","ACK_TIMEOUT","href","messageListener","listenForMessages","receivedMessages","parseMessage","sourceElement","originalEvent","RECEIVE_MESSAGE_TYPES","respond","fireAndForget","originalSource","handleError","SEND_MESSAGE_STRATEGIES","foreignGlobal","sendToParent","client","tagName","HTMLElement","hasResult","ackTimeout","remaining","send","enableMockMode","disableMockMode","disable","errorOnClose","on","myListener","serializeMethod","serializeMethods","deserializeMethod","deserializeError","deserializeMethods","methods","listenForMethods","meth","destination","isSerialized","__type__","__id__","__name__","serializeError","__message__","wrapper","initOnReady","onWindowReady","readyPromises","init","reset","initialized","module","exports"],"mappings":"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","file":"post-robot.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"postRobot\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"postRobot\"] = factory();\n\telse\n\t\troot[\"postRobot\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 31);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e8bcbf68075f383ae0e3","\nexport * from './config';\nexport * from './constants';\n\n\n// WEBPACK FOOTER //\n// ./src/conf/index.js","\nexport * from './promise';\nexport * from './util';\nexport * from './log';\nexport * from './windows';\nexport * from './methods';\nexport * from './tick';\nexport * from './ready';\nexport * from './cleanup';\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/index.js","\nimport { CONSTANTS } from './conf';\nimport { cleanup } from './lib/cleanup';\n\nexport let global = window[CONSTANTS.WINDOW_PROPS.POSTROBOT] = window[CONSTANTS.WINDOW_PROPS.POSTROBOT] || {};\n\nglobal.clean = global.clean || cleanup(global);\n\n// Backwards compatibility\n\nglobal.registerSelf = () => {\n    // pass\n};\n\n\n// WEBPACK FOOTER //\n// ./src/global.js","\nexport * from './receive';\nexport * from './send';\nexport * from './listeners';\n\n\n// WEBPACK FOOTER //\n// ./src/drivers/index.js","\nimport { CONSTANTS } from '../conf';\n\nexport let util = {\n\n    once(method) {\n        if (!method) {\n            return method;\n        }\n        let called = false;\n        return function onceWrapper() {\n            if (!called) {\n                called = true;\n                return method.apply(this, arguments);\n            }\n        };\n    },\n\n    noop() {}, // eslint-disable-line no-empty-function\n\n    safeHasProp(obj, name) {\n        try {\n            if (obj[name]) {\n                return true;\n            } else {\n                return false;\n            }\n        } catch (err) {\n            return false;\n        }\n    },\n\n    safeGetProp(obj, name) {\n        try {\n            return obj[name];\n        } catch (err) {\n            return;\n        }\n    },\n\n    listen(win, event, handler) {\n        if (win.addEventListener) {\n            win.addEventListener(event, handler);\n        } else {\n            win.attachEvent(`on${event}`, handler);\n        }\n\n        return {\n            cancel() {\n                if (win.removeEventListener) {\n                    win.removeEventListener(event, handler);\n                } else {\n                    win.detachEvent(`on${event}`, handler);\n                }\n            }\n        };\n    },\n\n    apply(method, context, args) {\n        if (typeof method.apply === 'function') {\n            return method.apply(context, args);\n        }\n        return method(args[0], args[1], args[2], args[3], args[4], args[5], args[6], args[7], args[8], args[9]);\n    },\n\n    find(collection, method, def) {\n        if (!collection) {\n            return def;\n        }\n        for (let i = 0; i < collection.length; i++) {\n            if (method(collection[i])) {\n                return collection[i];\n            }\n        }\n        return def;\n    },\n\n    map(collection, method) {\n        let results = [];\n        for (let i = 0; i < collection.length; i++) {\n            results.push(method(collection[i]));\n        }\n        return results;\n    },\n\n    some(collection, method) {\n        method = method || Boolean;\n        for (let i = 0; i < collection.length; i++) {\n            if (method(collection[i])) {\n                return true;\n            }\n        }\n        return false;\n    },\n\n    keys(mapping) {\n        let result = [];\n        for (let key in mapping) {\n            if (mapping.hasOwnProperty(key)) {\n                result.push(key);\n            }\n        }\n        return result;\n    },\n\n    values(mapping) {\n        let result = [];\n        for (let key in mapping) {\n            if (mapping.hasOwnProperty(key)) {\n                result.push(mapping[key]);\n            }\n        }\n        return result;\n    },\n\n    getByValue(mapping, value) {\n        for (let key in mapping) {\n            if (mapping.hasOwnProperty(key) && mapping[key] === value) {\n                return key;\n            }\n        }\n    },\n\n    uniqueID() {\n\n        let chars = '0123456789abcdef';\n\n        return 'xxxxxxxxxx'.replace(/./g, () => {\n            return chars.charAt(Math.floor(Math.random() * chars.length));\n        });\n    },\n\n    memoize(method) {\n\n        let results = {};\n\n        return function memoized() {\n            let args = JSON.stringify(Array.prototype.slice.call(arguments));\n            if (!results.hasOwnProperty(args)) {\n                results[args] = method.apply(this, arguments);\n            }\n            return results[args];\n        };\n    },\n\n    extend(obj, source) {\n        if (!source) {\n            return obj;\n        }\n\n        for (let key in source) {\n            if (source.hasOwnProperty(key)) {\n                obj[key] = source[key];\n            }\n        }\n\n        return obj;\n    },\n\n    each(obj, callback) {\n        if (Array.isArray(obj)) {\n            for (let i = 0; i < obj.length; i++) {\n                callback(obj[i], i);\n            }\n        } else if (typeof obj === 'object' && obj !== null) {\n            for (let key in obj) {\n                if (obj.hasOwnProperty(key)) {\n                    callback(obj[key], key);\n                }\n            }\n        }\n    },\n\n    replaceObject(obj, callback, depth = 1) {\n\n        if (depth >= 100) {\n            throw new Error(`Self-referential object passed, or object contained too many layers`);\n        }\n\n        let newobj = Array.isArray(obj) ? [] : {};\n\n        util.each(obj, (item, key) => {\n\n            let result = callback(item, key);\n\n            if (result !== undefined) {\n                newobj[key] = result;\n            } else if (typeof item === 'object' && item !== null) {\n                newobj[key] = util.replaceObject(item, callback, depth + 1);\n            } else {\n                newobj[key] = item;\n            }\n        });\n\n        return newobj;\n    },\n\n    safeInterval(method, time) {\n        let timeout;\n\n        function runInterval() {\n            timeout = setTimeout(runInterval, time);\n            method.call();\n        }\n\n        timeout = setTimeout(runInterval, time);\n\n        return {\n            cancel() {\n                clearTimeout(timeout);\n            }\n        };\n    },\n\n    intervalTimeout(time, interval, method) {\n\n        let safeInterval = util.safeInterval(() => {\n            time -= interval;\n\n            time = time <= 0 ? 0 : time;\n\n            if (time === 0) {\n                safeInterval.cancel();\n            }\n\n            method(time);\n        }, interval);\n\n        return safeInterval;\n    },\n\n    getDomain(win) {\n\n        win = win || window;\n\n        if (win.mockDomain && win.mockDomain.indexOf(CONSTANTS.MOCK_PROTOCOL) === 0) {\n            return win.mockDomain;\n        }\n\n        if (!win.location.protocol) {\n            throw new Error(`Can not read window protocol`);\n        }\n\n        if (win.location.protocol === CONSTANTS.FILE_PROTOCOL) {\n            return `${win.location.protocol}//${win.location.host}`;\n        }\n\n        if (!win.location.host) {\n            throw new Error(`Can not read window host`);\n        }\n\n        return `${win.location.protocol}//${win.location.host}`;\n    },\n\n    getDomainFromUrl(url) {\n\n        let domain;\n\n        if (url.match(/^(https?|mock|file):\\/\\//)) {\n            domain = url;\n        } else {\n            return this.getDomain();\n        }\n\n        domain = domain.split('/').slice(0, 3).join('/');\n\n        return domain;\n    },\n\n    safeGet(obj, prop) {\n\n        let result;\n\n        try {\n            result = obj[prop];\n        } catch (err) {\n            // pass\n        }\n\n        return result;\n    }\n};\n\n\n// WEBPACK FOOTER //\n// ./src/lib/util.js","\nimport { getAncestor } from '../lib/windows';\n\nexport * from './client';\nexport * from './server';\nexport * from './config';\n\nimport * as windowUtil from '../lib/windows';\n\nexport let parent = getAncestor();\n\nexport { openBridge, linkUrl, isBridge, needsBridge, needsBridgeForBrowser, needsBridgeForWin, needsBridgeForDomain, openTunnelToOpener, destroyBridges } from '../bridge';\n\nexport { util } from '../lib/util';\n\nexport let winutil = windowUtil;\n\n\n\n// WEBPACK FOOTER //\n// ./src/interface/index.js","\nfunction trycatch(method, successHandler, errorHandler) {\n\n    let isCalled = false;\n    let isSuccess = false;\n    let isError = false;\n    let err, res;\n\n    function flush() {\n        if (isCalled) {\n            if (isError) {\n                return errorHandler(err);\n            } else if (isSuccess) {\n                return successHandler(res);\n            }\n        }\n    }\n\n    try {\n        method(function(result) {\n            res = result;\n            isSuccess = true;\n            flush();\n        }, function(error) {\n            err = error;\n            isError = true;\n            flush();\n        });\n    } catch (error) {\n        return errorHandler(error);\n    }\n\n    isCalled = true;\n    flush();\n}\n\nlet possiblyUnhandledPromiseHandlers = [];\nlet possiblyUnhandledPromises = [];\nlet possiblyUnhandledPromiseTimeout;\n\nfunction addPossiblyUnhandledPromise(promise) {\n    possiblyUnhandledPromises.push(promise);\n    possiblyUnhandledPromiseTimeout = possiblyUnhandledPromiseTimeout || setTimeout(flushPossiblyUnhandledPromises, 1);\n}\n\nfunction flushPossiblyUnhandledPromises() {\n\n    possiblyUnhandledPromiseTimeout = null;\n    let promises = possiblyUnhandledPromises;\n    possiblyUnhandledPromises = [];\n\n    for (let i = 0; i < promises.length; i++) {\n        let promise = promises[i];\n\n        if (promise.silentReject) {\n            continue;\n        }\n\n        promise.handlers.push({\n            onError(err) {\n                if (promise.silentReject) {\n                    return;\n                }\n\n                dispatchError(err);\n            }\n        });\n\n        promise.dispatch();\n    }\n}\n\nlet dispatchedErrors = [];\n\nfunction dispatchError(err) {\n\n    if (dispatchedErrors.indexOf(err) !== -1) {\n        return;\n    }\n\n    dispatchedErrors.push(err);\n\n    setTimeout(() => {\n        throw err;\n    }, 1);\n\n    for (let j = 0; j < possiblyUnhandledPromiseHandlers.length; j++) {\n        possiblyUnhandledPromiseHandlers[j](err);\n    }\n}\n\n\nlet toString = ({}).toString;\n\nfunction isPromise(item) {\n    try {\n        if (!item) {\n            return false;\n        }\n\n        if (window.Window && item instanceof window.Window) {\n            return false;\n        }\n\n        if (window.constructor && item instanceof window.constructor) {\n            return false;\n        }\n\n        if (toString) {\n            let name = toString.call(item);\n\n            if (name === '[object Window]' || name === '[object global]' || name === '[object DOMWindow]') {\n                return false;\n            }\n        }\n\n        if (item && item.then instanceof Function) {\n            return true;\n        }\n    } catch (err) {\n        return false\n    }\n\n    return false\n}\n\nexport let SyncPromise = function SyncPromise(handler) {\n\n    this.resolved = false;\n    this.rejected = false;\n\n    this.silentReject = false;\n\n    this.handlers = [];\n\n    addPossiblyUnhandledPromise(this);\n\n    if (!handler) {\n        return;\n    }\n\n    let self = this;\n\n    trycatch(handler, function(res) {\n        return self.resolve(res);\n    }, function(err) {\n        return self.reject(err);\n    });\n};\n\nSyncPromise.resolve = function SyncPromiseResolve(value) {\n\n    if (isPromise(value)) {\n        return value;\n    }\n\n    return new SyncPromise().resolve(value);\n};\n\nSyncPromise.reject = function SyncPromiseResolve(error) {\n    return new SyncPromise().reject(error);\n};\n\nSyncPromise.prototype.resolve = function (result) {\n    if (this.resolved || this.rejected) {\n        return this;\n    }\n\n    if (isPromise(result)) {\n        throw new Error('Can not resolve promise with another promise');\n    }\n\n    this.resolved = true;\n    this.value = result;\n    this.dispatch();\n\n    return this;\n};\n\nSyncPromise.prototype.reject = function(error) {\n    if (this.resolved || this.rejected) {\n        return this;\n    }\n\n    if (isPromise(error)) {\n        throw new Error('Can not reject promise with another promise');\n    }\n\n    this.rejected = true;\n    this.value = error;\n    this.dispatch();\n\n    return this;\n};\n\nSyncPromise.prototype.asyncReject = function(error) {\n    this.silentReject = true;\n    this.reject(error);\n}\n\nSyncPromise.prototype.dispatch = function() {\n\n    if (!this.resolved && !this.rejected) {\n        return;\n    }\n\n    while (this.handlers.length) {\n\n        let handler = this.handlers.shift();\n\n        let result, error;\n\n        try {\n            if (this.resolved) {\n                result = handler.onSuccess ? handler.onSuccess(this.value) : this.value;\n            } else if (this.rejected) {\n                if (handler.onError) {\n                    result = handler.onError(this.value);\n                } else {\n                    error = this.value;\n                }\n            }\n        } catch (err) {\n            error = err;\n        }\n\n        if (result === this) {\n            throw new Error('Can not return a promise from the the then handler of the same promise');\n        }\n\n        if (!handler.promise) {\n            continue;\n        }\n\n        if (error) {\n            handler.promise.reject(error);\n\n        } else if (isPromise(result)) {\n            result.then(res => { handler.promise.resolve(res); },\n                        err => { handler.promise.reject(err);  });\n\n        } else {\n            handler.promise.resolve(result);\n        }\n    }\n};\n\nSyncPromise.prototype.then = function(onSuccess, onError) {\n\n    if (onSuccess && typeof onSuccess !== 'function' && !onSuccess.call) {\n        throw new Error('Promise.then expected a function for success handler');\n    }\n\n    if (onError && typeof onError !== 'function' && !onError.call) {\n        throw new Error('Promise.then expected a function for error handler');\n    }\n\n    let promise = new SyncPromise(null, this);\n\n    this.handlers.push({\n        promise: promise,\n        onSuccess: onSuccess,\n        onError: onError\n    });\n\n    this.silentReject = true;\n\n    this.dispatch();\n\n    return promise;\n};\n\nSyncPromise.prototype.catch = function(onError) {\n    return this.then(null, onError);\n};\n\nSyncPromise.prototype.finally = function(handler) {\n    return this.then(function(result) {\n        return SyncPromise.try(handler)\n            .then(() => {\n                return result;\n            });\n    }, function(err) {\n        return SyncPromise.try(handler)\n            .then(() => {\n                throw err;\n            });\n    });\n};\n\nSyncPromise.all = function(promises) {\n\n    let promise = new SyncPromise();\n    let count = promises.length;\n    let results = [];\n\n    for (let i = 0; i < promises.length; i++) {\n\n        let prom = isPromise(promises[i]) ? promises[i] : SyncPromise.resolve(promises[i]);\n\n        prom.then(function(result) {\n            results[i] = result;\n            count -= 1;\n            if (count === 0) {\n                promise.resolve(results);\n            }\n        }, function(err) {\n            promise.reject(err);\n        });\n    }\n\n    if (!count) {\n        promise.resolve(results);\n    }\n\n    return promise;\n};\n\nSyncPromise.onPossiblyUnhandledException = function syncPromiseOnPossiblyUnhandledException(handler) {\n    possiblyUnhandledPromiseHandlers.push(handler);\n};\n\nSyncPromise.try = function syncPromiseTry(method) {\n    return SyncPromise.resolve().then(method);\n}\n\nSyncPromise.delay = function syncPromiseDelay(delay) {\n    return new SyncPromise(resolve => {\n        setTimeout(resolve, delay);\n    });\n}\n\nSyncPromise.hash = function(obj) {\n\n    let results = {};\n    let promises = [];\n\n    for (let key in obj) {\n        if (obj.hasOwnProperty(key)) {\n            promises.push(SyncPromise.resolve(obj[key]).then(result => {\n                results[key] = result;\n            }));\n        }\n    }\n\n    return SyncPromise.all(promises).then(() => {\n        return results;\n    });\n}\n\nSyncPromise.promisifyCall = function() {\n\n    let args = Array.prototype.slice.call(arguments);\n    let method = args.shift();\n\n    if (typeof method !== 'function') {\n        throw new Error(`Expected promisifyCall to be called with a function`);\n    }\n\n    return new SyncPromise((resolve, reject) => {\n\n        args.push((err, result) => {\n            return err ? reject(err) : resolve(result);\n        });\n\n        return method.apply(null, args);\n    });\n}\n\n\nexport function patchPromise() {\n    window.Promise = SyncPromise;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./~/sync-browser-mocks/src/promise.js","\nimport { util } from './util';\nimport { global } from '../global';\nimport { CONSTANTS } from '../conf';\n\nglobal.domainMatches = global.domainMatches || [];\n\nlet domainMatchTimeout;\n\nexport function isSameDomain(win) {\n\n    for (let match of global.domainMatches) {\n        if (match.win === win) {\n            return match.match;\n        }\n    }\n\n    let match;\n\n    try {\n        if (util.getDomain(window) === util.getDomain(win)) {\n            match = true;\n        } else {\n            match = false;\n        }\n    } catch (err) {\n        match = false;\n    }\n\n    global.clean.push(global.domainMatches, { win, match });\n\n    if (!domainMatchTimeout) {\n        domainMatchTimeout = setTimeout(() => {\n            global.domainMatches = [];\n            domainMatchTimeout = null;\n        }, 1);\n    }\n\n    return match;\n}\n\n\nexport function getOpener(win) {\n\n    if (!win) {\n        return;\n    }\n\n    try {\n        return win.opener;\n    } catch (err) {\n        return;\n    }\n}\n\nexport function getParent(win) {\n\n    if (!win) {\n        return;\n    }\n\n    try {\n        if (win.parent && win.parent !== win) {\n            return win.parent;\n        }\n    } catch (err) {\n        return;\n    }\n}\n\n\n\nexport function getParents(win) {\n\n    let result = [];\n\n    try {\n\n        while (win.parent !== win) {\n            result.push(win.parent);\n            win = win.parent;\n        }\n\n    } catch (err) {\n        // pass\n    }\n\n    return result;\n}\n\nexport function isAncestorParent(parent, child) {\n\n    if (!parent || !child) {\n        return false;\n    }\n\n    let childParent = getParent(child);\n\n    if (childParent) {\n        return childParent === parent;\n    }\n\n    if (getParents(child).indexOf(parent) !== -1) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function getFrames(win) {\n\n    let result = [];\n\n    let frames;\n\n    try {\n        frames = win.frames;\n    } catch (err) {\n        frames = win;\n    }\n\n    let len;\n\n    try {\n        len = frames.length;\n    } catch (err) {\n        // pass\n    }\n\n    if (len === 0) {\n        return result;\n    }\n\n    if (len) {\n        for (let i = 0; i < len; i++) {\n\n            let frame;\n\n            try {\n                frame = frames[i];\n            } catch (err) {\n                continue;\n            }\n\n            result.push(frame);\n        }\n\n        return result;\n    }\n\n    for (let i = 0; i < 100; i++) {\n        let frame;\n\n        try {\n            frame = frames[i];\n        } catch (err) {\n            return result;\n        }\n\n        if (!frame) {\n            return result;\n        }\n\n        result.push(frame);\n    }\n\n    return result;\n}\n\n\nexport function getAllChildFrames(win) {\n\n    let result = [];\n\n    for (let frame of getFrames(win)) {\n        result.push(frame);\n\n        for (let childFrame of getAllChildFrames(frame)) {\n            result.push(childFrame);\n        }\n    }\n\n    return result;\n}\n\nexport function getAllFramesInWindow(win) {\n\n    let result = getAllChildFrames(win);\n\n    result.push(win);\n\n    for (let parent of getParents(win)) {\n\n        result.push(parent);\n\n        for (let frame of getFrames(parent)) {\n\n            if (result.indexOf(frame) === -1) {\n                result.push(frame);\n            }\n        }\n    }\n\n    return result;\n}\n\nexport function getTop(win) {\n\n    if (!win) {\n        return;\n    }\n\n    try {\n        if (win.top) {\n            return win.top;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    if (getParent(win) === win) {\n        return win;\n    }\n\n    try {\n        if (isAncestorParent(window, win)) {\n            return window.top;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    try {\n        if (isAncestorParent(win, window)) {\n            return window.top;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    for (let frame of getAllChildFrames(win)) {\n        try {\n            if (frame.top) {\n                return frame.top;\n            }\n        } catch (err) {\n            // pass\n        }\n\n        if (getParent(frame) === frame) {\n            return frame;\n        }\n    }\n}\n\n\nexport function isWindowClosed(win, allowMock = true) {\n\n    try {\n        if (win === window) {\n            return false;\n        }\n    } catch (err) {\n        return true;\n    }\n\n\n    try {\n        if (!win) {\n            return true;\n        }\n\n    } catch (err) {\n        return true;\n    }\n\n    try {\n        if (win.closed) {\n            return true;\n        }\n\n    } catch (err) {\n\n        // I love you so much IE\n\n        if (err && err.message === 'Call was rejected by callee.\\r\\n') {\n            return false;\n        }\n\n        return true;\n    }\n\n\n    if (allowMock && isSameDomain(win) && util.safeGet(win, 'mockclosed')) {\n        return true;\n    }\n\n    /*\n\n    // IE9... don't even ask. If an iframe is removed from the parent page, .closed does not get set to true\n\n    try {\n        if (win.parent === win && !getOpener(win) && win !== getTop(window)) {\n            // return true;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    */\n\n\n    return false;\n}\n\nexport function getUserAgent(win) {\n    win = win || window;\n    return win.navigator.mockUserAgent || win.navigator.userAgent;\n}\n\n\nexport function getFrameByName(win, name) {\n\n    let winFrames = getFrames(win);\n\n    for (let childFrame of winFrames) {\n        try {\n            if (isSameDomain(childFrame) && childFrame.name === name && winFrames.indexOf(childFrame) !== -1) {\n                return childFrame;\n            }\n        } catch (err) {\n            // pass\n        }\n    }\n\n    try {\n        if (winFrames.indexOf(win.frames[name]) !== -1) {\n            return win.frames[name];\n        }\n    } catch (err) {\n        // pass\n    }\n\n    try {\n        if (winFrames.indexOf(win[name]) !== -1) {\n            return win[name];\n        }\n    } catch (err) {\n        // pass\n    }\n}\n\nexport function findChildFrameByName(win, name) {\n\n    let frame = getFrameByName(win, name);\n\n    if (frame) {\n        return frame;\n    }\n\n    for (let childFrame of getFrames(win)) {\n        let namedFrame = findChildFrameByName(childFrame, name);\n\n        if (namedFrame) {\n            return namedFrame;\n        }\n    }\n}\n\nexport function findFrameByName(win, name) {\n\n    let frame;\n\n    frame = getFrameByName(win, name);\n\n    if (frame) {\n        return frame;\n    }\n\n    return findChildFrameByName(getTop(win), name);\n}\n\nexport function isParent(win, frame) {\n\n    let frameParent = getParent(frame);\n\n    if (frameParent) {\n        return frameParent === win;\n    }\n\n    for (let childFrame of getFrames(win)) {\n        if (childFrame === frame) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nexport function isOpener(parent, child) {\n\n    return parent === getOpener(child);\n}\n\nexport function getAncestor(win) {\n    win = win || window;\n\n    let opener = getOpener(win);\n\n    if (opener) {\n        return opener;\n    }\n\n    let parent = getParent(win);\n\n    if (parent) {\n        return parent;\n    }\n}\n\nexport function getAncestors(win) {\n\n    let results = [];\n\n    let ancestor = win;\n\n    while (ancestor) {\n        ancestor = getAncestor(ancestor);\n        if (ancestor) {\n            results.push(ancestor);\n        }\n    }\n\n    return results;\n}\n\n\nexport function isAncestor(parent, child) {\n\n    let actualParent = getAncestor(child);\n\n    if (actualParent) {\n        if (actualParent === parent) {\n            return true;\n        }\n\n        return false;\n    }\n\n    if (child === parent) {\n        return false;\n    }\n\n    if (getTop(child) === child) {\n        return false;\n    }\n\n    for (let frame of getFrames(parent)) {\n        if (frame === child) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nexport function isPopup() {\n    return Boolean(getOpener(window));\n}\n\nexport function isIframe() {\n    return Boolean(getParent(window));\n}\n\nexport function isFullpage() {\n    return Boolean(!isIframe() && !isPopup());\n}\n\nexport function getWindowType() {\n    if (isPopup()) {\n        return CONSTANTS.WINDOW_TYPES.POPUP;\n    }\n    if (isIframe()) {\n        return CONSTANTS.WINDOW_TYPES.IFRAME;\n    }\n    return CONSTANTS.WINDOW_TYPES.FULLPAGE;\n}\n\n\nfunction anyMatch(collection1, collection2) {\n\n    for (let item1 of collection1) {\n        for (let item2 of collection2) {\n            if (item1 === item2) {\n                return true;\n            }\n        }\n    }\n}\n\nexport function isSameTopWindow(win1, win2) {\n\n    let top1 = getTop(win1);\n    let top2 = getTop(win2);\n\n    try {\n        if (top1 && top2) {\n            if (top1 === top2) {\n                return true;\n            }\n\n            return false;\n        }\n    } catch (err) {\n        // pass\n    }\n\n    let allFrames1 = getAllFramesInWindow(win1);\n    let allFrames2 = getAllFramesInWindow(win2);\n\n    if (anyMatch(allFrames1, allFrames2)) {\n        return true;\n    }\n\n    let opener1 = getOpener(top1);\n    let opener2 = getOpener(top2);\n\n    if (opener1 && anyMatch(getAllFramesInWindow(opener1), allFrames2)) {\n        return false;\n    }\n\n    if (opener2 && anyMatch(getAllFramesInWindow(opener2), allFrames1)) {\n        return false;\n    }\n}\n\nexport function jsonStringify() {\n\n    let objectToJSON;\n    let arrayToJSON;\n\n    try {\n        if (JSON.stringify({}) !== '{}') {\n            objectToJSON = Object.prototype.toJSON;\n            delete Object.prototype.toJSON;\n        }\n\n        if (JSON.stringify({}) !== '{}') {\n            throw new Error(`Can not correctly serialize JSON objects`);\n        }\n\n        if (JSON.stringify([]) !== '[]') {\n            arrayToJSON  = Array.prototype.toJSON;\n            delete Array.prototype.toJSON;\n        }\n\n        if (JSON.stringify([]) !== '[]') {\n            throw new Error(`Can not correctly serialize JSON objects`);\n        }\n\n    } catch (err) {\n        throw new Error(`Can not repair JSON.stringify: ${err.message}`);\n    }\n\n    let result = JSON.stringify.apply(this, arguments);\n\n    try {\n        if (objectToJSON) {\n            Object.prototype.toJSON = objectToJSON; // eslint-disable-line\n        }\n\n        if (arrayToJSON) {\n            Array.prototype.toJSON = arrayToJSON; // eslint-disable-line\n        }\n\n    } catch (err) {\n        throw new Error(`Can not repair JSON.stringify: ${err.message}`);\n    }\n\n\n    return result;\n}\n\nexport function jsonParse() {\n    return JSON.parse.apply(this, arguments);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/windows.js","\nexport * from './bridge';\nexport * from './child';\nexport * from './common';\nexport * from './parent';\n\n\n\n// WEBPACK FOOTER //\n// ./src/bridge/index.js","\nimport { CONFIG, CONSTANTS } from '../conf';\nimport { util, promise, isSameDomain, isOpener, isSameTopWindow, getUserAgent } from '../lib';\nimport { global } from '../global';\nimport { receiveMessage } from '../drivers';\n\nexport function needsBridgeForBrowser() {\n\n    if (getUserAgent(window).match(/MSIE|trident|edge/i)) {\n        return true;\n    }\n\n    if (!CONFIG.ALLOW_POSTMESSAGE_POPUP) {\n        return true;\n    }\n\n    return false;\n}\n\nexport function needsBridgeForWin(win) {\n\n    if (win && isSameTopWindow(window, win)) {\n        return false;\n    }\n\n    if (win && isSameDomain(win)) {\n        return false;\n    }\n\n    return true;\n}\n\nexport function needsBridgeForDomain(domain) {\n\n    if (domain && util.getDomain() === util.getDomainFromUrl(domain)) {\n        return false;\n    }\n\n    return true;\n}\n\nexport function needsBridge({ win, domain }) {\n    return needsBridgeForBrowser() && needsBridgeForWin(win) && needsBridgeForDomain(domain);\n}\n\nexport function getBridgeName(domain) {\n\n    domain = domain || util.getDomainFromUrl(domain);\n\n    let sanitizedDomain = domain.replace(/[^a-zA-Z0-9]+/g, '_');\n\n    let id = `${CONSTANTS.BRIDGE_NAME_PREFIX}_${sanitizedDomain}`;\n\n    return id;\n}\n\nexport function isBridge() {\n    return window.name && window.name === getBridgeName(util.getDomain());\n}\n\nexport let documentBodyReady = new promise.Promise(resolve => {\n\n    if (window.document && window.document.body) {\n        return resolve(window.document.body);\n    }\n\n    let interval = setInterval(() => {\n        if (window.document && window.document.body) {\n            clearInterval(interval);\n            return resolve(window.document.body);\n        }\n    }, 10);\n});\n\nglobal.remoteWindows = global.remoteWindows || [];\n\nexport function registerRemoteWindow(win, timeout = CONFIG.BRIDGE_TIMEOUT) {\n    let sendMessagePromise = new promise.Promise();\n    global.clean.push(global.remoteWindows, { win, sendMessagePromise });\n}\n\nexport function findRemoteWindow(win) {\n    for (let i = 0; i < global.remoteWindows.length; i++) {\n        if (global.remoteWindows[i].win === win) {\n            return global.remoteWindows[i];\n        }\n    }\n}\n\nexport function registerRemoteSendMessage(win, domain, sendMessage) {\n\n    let remoteWindow = findRemoteWindow(win);\n\n    if (!remoteWindow) {\n        throw new Error(`Window not found to register sendMessage to`);\n    }\n\n    let sendMessageWrapper = (remoteWin, message, remoteDomain) => {\n\n        if (remoteWin !== win) {\n            throw new Error(`Remote window does not match window`);\n        }\n\n        if (remoteDomain !== `*` && remoteDomain !== domain) {\n            throw new Error(`Remote domain ${remoteDomain} does not match domain ${domain}`);\n        }\n\n        sendMessage(message);\n    };\n\n    remoteWindow.sendMessagePromise.resolve(sendMessageWrapper);\n    remoteWindow.sendMessagePromise = promise.Promise.resolve(sendMessageWrapper);\n}\n\nexport function rejectRemoteSendMessage(win, err) {\n\n    let remoteWindow = findRemoteWindow(win);\n\n    if (!remoteWindow) {\n        throw new Error(`Window not found on which to reject sendMessage`);\n    }\n\n    remoteWindow.sendMessagePromise.asyncReject(err);\n}\n\nexport function sendBridgeMessage(win, message, domain) {\n\n    let messagingChild  = isOpener(window, win);\n    let messagingParent = isOpener(win, window);\n\n    if (!messagingChild && !messagingParent) {\n        throw new Error(`Can only send messages to and from parent and popup windows`);\n    }\n\n    let remoteWindow = findRemoteWindow(win);\n\n    if (!remoteWindow) {\n        throw new Error(`Window not found to send message to`);\n    }\n\n    return remoteWindow.sendMessagePromise.then(sendMessage => {\n        return sendMessage(win, message, domain);\n    });\n}\n\nglobal.receiveMessage = function(event) {\n    return receiveMessage(event);\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/bridge/common.js","\nimport { util } from './util';\nimport { getWindowType, jsonStringify } from './windows';\nimport { CONFIG } from '../conf';\n\nconst LOG_LEVELS = ['debug', 'info', 'warn', 'error'];\n\nif (Function.prototype.bind && window.console && typeof console.log === 'object') {\n    [ 'log', 'info', 'warn', 'error' ].forEach(function(method) {\n        console[method] = this.bind(console[method], console);\n    }, Function.prototype.call);\n}\n\nexport let log = {\n\n    clearLogs() {\n\n        if (window.console && window.console.clear) {\n            window.console.clear();\n        }\n\n        if (CONFIG.LOG_TO_PAGE) {\n            let container = document.getElementById('postRobotLogs');\n\n            if (container) {\n                container.parentNode.removeChild(container);\n            }\n        }\n    },\n\n    writeToPage(level, args) {\n        setTimeout(() => {\n            let container = document.getElementById('postRobotLogs');\n\n            if (!container) {\n                container = document.createElement('div');\n                container.id = 'postRobotLogs';\n                container.style.cssText = 'width: 800px; font-family: monospace; white-space: pre-wrap;';\n                document.body.appendChild(container);\n            }\n\n            let el = document.createElement('div');\n\n            let date = (new Date()).toString().split(' ')[4];\n\n            let payload = util.map(args, item => {\n                if (typeof item === 'string') {\n                    return item;\n                }\n                if (!item) {\n                    return Object.prototype.toString.call(item);\n                }\n                let json;\n                try {\n                    json = jsonStringify(item, 0, 2);\n                } catch (e) {\n                    json = '[object]';\n                }\n\n                return `\\n\\n${json}\\n\\n`;\n            }).join(' ');\n\n\n            let msg = `${date} ${level} ${payload}`;\n            el.innerHTML = msg;\n\n            let color = {\n                log: '#ddd',\n                warn: 'orange',\n                error: 'red',\n                info: 'blue',\n                debug: '#aaa'\n            }[level];\n\n            el.style.cssText = `margin-top: 10px; color: ${color};`;\n\n            if (!container.childNodes.length) {\n                container.appendChild(el);\n            } else {\n                container.insertBefore(el, container.childNodes[0]);\n            }\n\n        });\n    },\n\n    logLevel(level, args) {\n        setTimeout(() => {\n            try {\n                if (LOG_LEVELS.indexOf(level) < LOG_LEVELS.indexOf(CONFIG.LOG_LEVEL)) {\n                    return;\n                }\n\n                args = Array.prototype.slice.call(args);\n\n                args.unshift(`${window.location.host}${window.location.pathname}`);\n                args.unshift(`::`);\n                args.unshift(`${getWindowType().toLowerCase()}`);\n                args.unshift('[post-robot]');\n\n                if (CONFIG.LOG_TO_PAGE) {\n                    log.writeToPage(level, args);\n                }\n\n                if (!window.console) {\n                    return;\n                }\n\n                if (!window.console[level]) {\n                    level = 'log';\n                }\n\n                if (!window.console[level]) {\n                    return;\n                }\n\n                window.console[level].apply(window.console, args);\n\n            } catch (err) {\n                // pass\n            }\n        }, 1);\n    },\n\n    debug() {\n        log.logLevel('debug', arguments);\n    },\n\n    info() {\n        log.logLevel('info', arguments);\n    },\n\n    warn() {\n        log.logLevel('warn', arguments);\n    },\n\n    error() {\n        log.logLevel('error', arguments);\n    }\n};\n\n\n// WEBPACK FOOTER //\n// ./src/lib/log.js","\nexport * from './ie';\n\n\n// WEBPACK FOOTER //\n// ./src/compat/index.js","\nexport let CONSTANTS = {\n\n    POST_MESSAGE_TYPE: {\n        REQUEST: 'postrobot_message_request',\n        RESPONSE: 'postrobot_message_response',\n        ACK: 'postrobot_message_ack'\n    },\n\n    POST_MESSAGE_ACK: {\n        SUCCESS: 'success',\n        ERROR: 'error'\n    },\n\n    POST_MESSAGE_NAMES: {\n        METHOD: 'postrobot_method',\n        READY: 'postrobot_ready',\n        OPEN_TUNNEL: 'postrobot_open_tunnel'\n    },\n\n    WINDOW_TYPES: {\n        FULLPAGE: 'fullpage',\n        POPUP: 'popup',\n        IFRAME: 'iframe'\n    },\n\n    WINDOW_PROPS: {\n        POSTROBOT: '__postRobot__'\n    },\n\n    SERIALIZATION_TYPES: {\n        METHOD: 'postrobot_method',\n        ERROR: 'postrobot_error'\n    },\n\n    SEND_STRATEGIES: {\n        POST_MESSAGE: 'postrobot_post_message',\n        BRIDGE: 'postrobot_bridge',\n        GLOBAL: 'postrobot_global'\n    },\n\n    MOCK_PROTOCOL: 'mock:',\n    FILE_PROTOCOL: 'file:',\n\n    BRIDGE_NAME_PREFIX: '__postrobot_bridge__',\n    POSTROBOT_PROXY: '__postrobot_proxy__'\n};\n\nexport let POST_MESSAGE_NAMES_LIST = Object.keys(CONSTANTS.POST_MESSAGE_NAMES).map(key => CONSTANTS.POST_MESSAGE_NAMES[key]);\n\n\n\n// WEBPACK FOOTER //\n// ./src/conf/constants.js","\nimport { global } from '../global';\n\nglobal.listeners = global.listeners || {\n    request: [],\n    response: []\n};\n\nexport let listeners = global.listeners;\n\nexport function resetListeners() {\n    global.listeners.request = [];\n    global.listeners.response = [];\n}\n\nfunction isRegex(item) {\n    return Object.prototype.toString.call(item) === '[object RegExp]';\n}\n\nfunction matchDomain(domain, origin) {\n\n    if (typeof domain === 'string') {\n\n        if (isRegex(origin)) {\n            return false;\n        }\n\n        if (Array.isArray(origin)) {\n            return false;\n        }\n\n        return domain === '*' || origin === domain;\n    }\n\n    if (isRegex(domain)) {\n\n        if (isRegex(origin)) {\n            return domain.toString() === origin.toString();\n        }\n\n        if (Array.isArray(origin)) {\n            return false;\n        }\n\n        return origin.match(domain);\n    }\n\n    if (Array.isArray(domain)) {\n\n        if (isRegex(origin)) {\n            return false;\n        }\n\n        if (Array.isArray(origin)) {\n            return JSON.stringify(domain) === JSON.stringify(origin);\n        }\n\n        return domain.indexOf(origin) !== -1;\n    }\n\n    return false;\n}\n\nexport function getRequestListener(name, win, domain) {\n\n    let result = {};\n\n    for (let requestListener of global.listeners.request) {\n\n        if (requestListener.name !== name) {\n            continue;\n        }\n\n        let specifiedWin = (requestListener.win && requestListener.win !== '*');\n        let specifiedDomain = (requestListener.domain && requestListener.domain !== '*');\n\n        let matchedWin = (specifiedWin && requestListener.win === win);\n        let matchedDomain = (specifiedDomain && matchDomain(requestListener.domain, domain));\n\n        if (specifiedWin && specifiedDomain) {\n            if (matchedWin && matchedDomain) {\n                result.all = result.all || requestListener.options;\n            }\n        } else if (specifiedDomain) {\n            if (matchedDomain) {\n                result.domain = result.domain || requestListener.options;\n            }\n        } else if (specifiedWin) {\n            if (matchedWin) {\n                result.win = result.win || requestListener.options;\n            }\n        } else {\n            result.name = result.name || requestListener.options;\n        }\n    }\n\n    return result.all || result.domain || result.win || result.name;\n}\n\nexport function removeRequestListener(options) {\n\n    for (let listener of global.listeners.request) {\n        if (listener.options === options) {\n            global.listeners.request.splice(global.listeners.request.indexOf(listener), 1);\n        }\n    }\n}\n\nexport function addRequestListener(name, win, domain, options, override) {\n\n    let listener = getRequestListener(name, win, domain);\n\n    if (listener) {\n        if (override) {\n            removeRequestListener(listener);\n        } else {\n\n            if (win) {\n                throw new Error(`Request listener already exists for ${name} on domain ${domain} for specified window: ${listener.win === win}`);\n            }\n\n            throw new Error(`Request listener already exists for ${name} on domain ${domain}`);\n        }\n    }\n\n    global.clean.push(global.listeners.request, { name, win, domain, options });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/drivers/listeners.js","\nimport { CONSTANTS, CONFIG, POST_MESSAGE_NAMES_LIST } from '../../conf';\nimport { util, promise, serializeMethods, log, isWindowClosed, getWindowType, jsonStringify } from '../../lib';\n\nimport { SEND_MESSAGE_STRATEGIES } from './strategies';\n\n\nexport function buildMessage(win, message, options = {}) {\n\n    let id   = util.uniqueID();\n    let type = getWindowType();\n    let sourceDomain = util.getDomain(window);\n\n    return {\n        ...message,\n        ...options,\n        sourceDomain,\n        id:         message.id || id,\n        windowType: type\n    };\n}\n\n\nexport function sendMessage(win, message, domain) {\n    return promise.run(() => {\n\n        message = buildMessage(win, message, {\n            data: serializeMethods(win, domain, message.data),\n            domain\n        });\n\n        let level;\n\n        if (POST_MESSAGE_NAMES_LIST.indexOf(message.name) !== -1 || message.type === CONSTANTS.POST_MESSAGE_TYPE.ACK) {\n            level = 'debug';\n        } else if (message.ack === 'error') {\n            level = 'error';\n        } else {\n            level = 'info';\n        }\n\n        log.logLevel(level, [ '\\n\\n\\t', '#send', message.type.replace(/^postrobot_message_/, ''), '::', message.name, '::', domain || '*', '\\n\\n', message ]);\n\n        if (CONFIG.MOCK_MODE) {\n            delete message.target;\n            return window[CONSTANTS.WINDOW_PROPS.POSTROBOT].postMessage({\n                origin: util.getDomain(window),\n                source: window,\n                data: jsonStringify(message, 0, 2)\n            });\n        }\n\n        if (win === window) {\n            throw new Error('Attemping to send message to self');\n        }\n\n        if (isWindowClosed(win)) {\n            throw new Error('Window is closed');\n        }\n\n        log.debug('Running send message strategies', message);\n\n        let messages = [];\n\n        let serializedMessage = jsonStringify({\n            [ CONSTANTS.WINDOW_PROPS.POSTROBOT ]: message\n        }, 0, 2);\n\n        return promise.map(Object.keys(SEND_MESSAGE_STRATEGIES), strategyName => {\n\n            return promise.run(() => {\n\n                if (!CONFIG.ALLOWED_POST_MESSAGE_METHODS[strategyName]) {\n                    throw new Error(`Strategy disallowed: ${strategyName}`);\n                }\n\n                return SEND_MESSAGE_STRATEGIES[strategyName](win, serializedMessage, domain);\n\n            }).then(() => {\n                messages.push(`${strategyName}: success`);\n                return true;\n            }, err => {\n                messages.push(`${strategyName}: ${err.stack || err.toString()}\\n`);\n                return false;\n            });\n\n        }).then(results => {\n\n            let success = util.some(results);\n            let status = `${message.type} ${message.name} ${success ? 'success' : 'error'}:\\n  - ${messages.join('\\n  - ')}\\n`;\n\n            log.debug(status);\n\n            if (!success) {\n                throw new Error(status);\n            }\n        });\n    });\n}\n\n\n// WEBPACK FOOTER //\n// ./src/drivers/send/index.js","\nimport { SyncPromise as Promise } from 'sync-browser-mocks/src/promise';\n\nexport function cleanup(obj) {\n\n    let tasks = [];\n\n    return {\n\n        getters: {\n            array:  () => { return []; },\n            object: () => { return {}; }\n        },\n\n        set(name, item) {\n            obj[name] = item;\n            this.register(() => {\n                delete obj[name];\n            });\n            return item;\n        },\n\n        push(collection, item) {\n            collection.push(item);\n            this.register(() => {\n                let index = collection.indexOf(item);\n                if (index !== -1) {\n                    collection.splice(index, 1);\n                }\n            });\n            return item;\n        },\n\n        setItem(mapping, key, item) {\n            mapping[key] = item;\n            this.register(() => {\n                delete mapping[key];\n            });\n            return item;\n        },\n\n        register(name, method) {\n\n            if (!method) {\n                method = name;\n                name = undefined;\n            }\n\n            tasks.push({\n                complete: false,\n\n                name,\n\n                run() {\n\n                    if (this.complete) {\n                        return;\n                    }\n\n                    this.complete = true;\n\n                    return method();\n                }\n            });\n        },\n\n        hasTasks() {\n            return Boolean(tasks.filter(item => !item.complete).length);\n        },\n\n        all() {\n            let results = [];\n\n            while (tasks.length) {\n                results.push(tasks.pop().run());\n            }\n\n            return Promise.all(results).then(() => {\n                return;\n            });\n        },\n\n        run(name) {\n            let results = [];\n            let toClean = [];\n\n            for (let item of tasks) {\n                if (item.name === name) {\n                    toClean.push(item);\n                    results.push(item.run());\n                }\n            }\n\n            for (let item of toClean) {\n                tasks.splice(tasks.indexOf(item), 1);\n            }\n\n            return Promise.all(results).then(() => {\n                return;\n            });\n        }\n    };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/cleanup.js","\nimport { SyncPromise } from 'sync-browser-mocks/src/promise';\nimport { nextTick } from './tick';\n\nexport let Promise = SyncPromise;\n\nexport let promise = {\n\n    Promise,\n\n    run(method) {\n        return Promise.resolve().then(method);\n    },\n\n    nextTick(method) {\n        return new Promise((resolve, reject) => {\n            nextTick(() => {\n                return promise.run(method).then(resolve, reject);\n            });\n        });\n    },\n\n    method(method) {\n        return function promiseWrapper() {\n            return Promise.resolve().then(() => {\n                return method.apply(this, arguments);\n            });\n        };\n    },\n\n    nodeify(prom, callback) {\n        if (!callback) {\n            return prom;\n        }\n        prom.then(result => {\n            callback(null, result);\n        }, err => {\n            callback(err);\n        });\n    },\n\n    deNodeify(method, ...args) {\n        return new Promise((resolve, reject) => {\n            try {\n                if (args.length < method.length) {\n                    return method(...args, (err, result) => {\n                        return err ? reject(err) : resolve(result);\n                    });\n                }\n\n                return promise.run(() => {\n                    return method(...args);\n                }).then(resolve, reject);\n\n            } catch (err) {\n                return reject(err);\n            }\n        });\n    },\n\n    map(items, method) {\n\n        let results = [];\n        for (let i = 0; i < items.length; i++) {\n            results.push(promise.run(() => {\n                return method(items[i]);\n            }));\n        }\n        return Promise.all(results);\n    }\n};\n\n\n// WEBPACK FOOTER //\n// ./src/lib/promise.js","\nimport { util } from './util';\n\nlet tickMessageName = `__nextTick__postRobot__${util.uniqueID()}`;\nlet queue = [];\n\nwindow.addEventListener('message', event => {\n    if (event.data === tickMessageName) {\n        let method = queue.shift();\n        method.call();\n    }\n});\n\nexport function nextTick(method) {\n\n    queue.push(method);\n    window.postMessage(tickMessageName, '*');\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/tick.js","\nimport { CONSTANTS } from '../conf';\nimport { getParent, isWindowClosed } from '../lib';\nimport { global } from '../global';\nimport { send } from '../interface';\n\nglobal.openTunnelToParent = function openTunnelToParent({ name, source, canary, sendMessage }) {\n\n    let remoteWindow = getParent(window);\n\n    if (!remoteWindow) {\n        throw new Error(`No parent window found to open tunnel to`);\n    }\n\n    return send(remoteWindow, CONSTANTS.POST_MESSAGE_NAMES.OPEN_TUNNEL, {\n        name,\n        sendMessage() {\n\n            if (isWindowClosed(source)) {\n                return;\n            }\n\n            try {\n                canary();\n            } catch (err) {\n                return;\n            }\n\n            sendMessage.apply(this, arguments);\n        }\n    }, { domain: '*' });\n};\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/bridge/bridge.js","\nimport { SyncPromise as Promise } from 'sync-browser-mocks/src/promise';\nimport { CONSTANTS } from '../conf';\nimport { isSameDomain, getOpener, getFrames, util, getFrameByName } from '../lib';\nimport { receiveMessage } from '../drivers';\n\nimport { needsBridge, registerRemoteWindow, rejectRemoteSendMessage, registerRemoteSendMessage, getBridgeName } from './common';\n\nfunction getRemoteBridgeForWindow(win) {\n    return Promise.try(() => {\n        for (let frame of getFrames(win)) {\n            try {\n                if (frame && frame !== window && isSameDomain(frame) && frame[CONSTANTS.WINDOW_PROPS.POSTROBOT]) {\n                    return frame;\n                }\n\n            } catch (err) {\n                continue;\n            }\n        }\n\n        try {\n            let frame = getFrameByName(win, getBridgeName(util.getDomain()));\n\n            if (!frame) {\n                return;\n            }\n\n            if (isSameDomain(frame) && frame[CONSTANTS.WINDOW_PROPS.POSTROBOT]) {\n                return frame;\n            }\n\n            return new Promise(resolve => {\n\n                let interval;\n                let timeout;\n\n                interval = setInterval(() => {\n                    if (isSameDomain(frame) && frame[CONSTANTS.WINDOW_PROPS.POSTROBOT]) {\n                        clearInterval(interval);\n                        clearTimeout(timeout);\n                        return resolve(frame);\n                    }\n\n                    setTimeout(() => {\n                        clearInterval(interval);\n                        return resolve();\n                    }, 2000);\n                }, 100);\n            });\n\n        } catch (err) {\n            return;\n        }\n    });\n}\n\nexport function openTunnelToOpener() {\n    return Promise.try(() => {\n\n        let opener = getOpener(window);\n\n        if (!opener) {\n            return;\n        }\n\n        if (!needsBridge({ win: opener })) {\n            return;\n        }\n\n        registerRemoteWindow(opener);\n\n        return getRemoteBridgeForWindow(opener).then(bridge => {\n\n            if (!bridge) {\n                return rejectRemoteSendMessage(opener, new Error(`Can not register with opener: no bridge found in opener`));\n            }\n\n            if (!window.name) {\n                return rejectRemoteSendMessage(opener, new Error(`Can not register with opener: window does not have a name`));\n            }\n\n            return bridge[CONSTANTS.WINDOW_PROPS.POSTROBOT].openTunnelToParent({\n\n                name: window.name,\n\n                source: window,\n\n                canary() {\n                    // pass\n                },\n\n                sendMessage(message) {\n\n                    if (!window || window.closed) {\n                        return;\n                    }\n\n                    receiveMessage({\n                        data:   message,\n                        origin: this.origin,\n                        source: this.source\n                    });\n                }\n\n            }).then(({ source, origin, data }) => {\n\n                if (source !== opener) {\n                    throw new Error(`Source does not match opener`);\n                }\n\n                registerRemoteSendMessage(source, origin, data.sendMessage);\n\n            }).catch(err => {\n\n                rejectRemoteSendMessage(opener, err);\n                throw err;\n            });\n        });\n    });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/bridge/child.js","\nimport { CONFIG, CONSTANTS } from '../conf';\nimport { util, promise, log, onWindowReady, getFrameByName } from '../lib';\nimport { global } from '../global';\nimport { on } from '../interface';\nimport { receiveMessage } from '../drivers';\n\nglobal.bridges = global.bridges || {};\n\nimport { getBridgeName, documentBodyReady, registerRemoteSendMessage, registerRemoteWindow } from './common';\n\nfunction listenForRegister(source, domain) {\n    on(CONSTANTS.POST_MESSAGE_NAMES.OPEN_TUNNEL, { source, domain }, ({ origin, data }) => {\n\n        if (origin !== domain) {\n            throw new Error(`Domain ${domain} does not match origin ${origin}`);\n        }\n\n        if (!data.name) {\n            throw new Error(`Register window expected to be passed window name`);\n        }\n\n        if (!data.sendMessage) {\n            throw new Error(`Register window expected to be passed sendMessage method`);\n        }\n\n        let winDetails = global.popupWindows[data.name];\n\n        if (!winDetails) {\n            throw new Error(`Window with name ${data.name} does not exist, or was not opened by this window`);\n        }\n\n        if (!winDetails.domain) {\n            throw new Error(`We do not have a registered domain for window ${data.name}`);\n        }\n\n        if (winDetails.domain !== origin) {\n            throw new Error(`Message origin ${origin} does not matched registered window origin ${winDetails.domain}`);\n        }\n\n        registerRemoteSendMessage(winDetails.win, domain, data.sendMessage);\n\n        return {\n            sendMessage(message) {\n\n                if (!window || window.closed) {\n                    return;\n                }\n\n                receiveMessage({\n                    data:   message,\n                    origin: winDetails.domain,\n                    source: winDetails.win\n                });\n            }\n        };\n    });\n}\n\nfunction openBridgeFrame(name, url) {\n\n    log.debug(`Opening bridge:`, name, url);\n\n    let iframe = document.createElement(`iframe`);\n\n    iframe.setAttribute(`name`, name);\n    iframe.setAttribute(`id`,   name);\n\n    iframe.setAttribute(`style`, `display: none; margin: 0; padding: 0; border: 0px none; overflow: hidden;`);\n    iframe.setAttribute(`frameborder`, `0`);\n    iframe.setAttribute(`border`, `0`);\n    iframe.setAttribute(`scrolling`, `no`);\n    iframe.setAttribute(`allowTransparency`, `true`);\n\n    iframe.setAttribute(`tabindex`, `-1`);\n    iframe.setAttribute(`hidden`, `true`);\n    iframe.setAttribute(`title`, ``);\n    iframe.setAttribute(`role`, `presentation`);\n\n    iframe.src = url;\n\n    return iframe;\n}\n\nexport function openBridge(url, domain) {\n\n    domain = domain || util.getDomainFromUrl(url);\n\n    if (global.bridges[domain]) {\n        return global.bridges[domain];\n    }\n\n    return global.clean.setItem(global.bridges, domain, promise.run(() => {\n\n        if (util.getDomain() === domain) {\n            throw new Error(`Can not open bridge on the same domain as current domain: ${domain}`);\n        }\n\n        let name  = getBridgeName(domain);\n        let frame = getFrameByName(window, name);\n\n        if (frame) {\n            throw new Error(`Frame with name ${name} already exists on page`);\n        }\n\n        let iframe = openBridgeFrame(name, url);\n\n        return documentBodyReady.then(body => {\n\n            return new promise.Promise((resolve, reject) => {\n\n                setTimeout(resolve, 1);\n\n            }).then(() => {\n\n                body.appendChild(iframe);\n\n                global.clean.register('bridgeFrames', () => {\n                    body.removeChild(iframe);\n                    delete global.bridges[domain];\n                });\n\n                let bridge = iframe.contentWindow;\n\n                listenForRegister(bridge, domain);\n\n                return new promise.Promise((resolve, reject) => {\n\n                    iframe.onload = resolve;\n                    iframe.onerror = reject;\n\n                }).then(() => {\n\n                    return onWindowReady(bridge, CONFIG.BRIDGE_TIMEOUT, `Bridge ${url}`);\n\n                }).then(() => {\n\n                    return bridge;\n                });\n            });\n        });\n    }));\n}\n\nexport function destroyBridges() {\n    return global.clean.run('bridgeFrames');\n}\n\nglobal.popupWindows = global.popupWindows || {};\n\nlet windowOpen = window.open;\n\nwindow.open = function(url, name, options, last) {\n\n    let domain = url;\n\n    if (url && url.indexOf(CONSTANTS.MOCK_PROTOCOL) === 0) {\n        [ domain, url ] = url.split('|');\n    }\n\n    if (domain) {\n        domain = util.getDomainFromUrl(domain);\n    }\n\n    let win = windowOpen.call(this, url, name, options, last);\n\n    if (url) {\n        registerRemoteWindow(win);\n    }\n\n    if (name) {\n        global.clean.setItem(global.popupWindows, name, { win, domain });\n    }\n\n    return win;\n};\n\nexport function linkUrl(win, url) {\n\n    for (let name of Object.keys(global.popupWindows)) {\n        let winOptions = global.popupWindows[name];\n\n        if (winOptions.win === win) {\n            winOptions.domain = util.getDomainFromUrl(url);\n\n            registerRemoteWindow(win);\n\n            break;\n        }\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/bridge/parent.js","\nimport { CONFIG } from '../conf';\nimport { isSameTopWindow } from '../lib';\n\nexport function emulateIERestrictions(sourceWindow, targetWindow) {\n    if (!CONFIG.ALLOW_POSTMESSAGE_POPUP) {\n\n        if (isSameTopWindow(sourceWindow, targetWindow) === false) {\n            throw new Error(`Can not send and receive post messages between two different windows (disabled to emulate IE)`);\n        }\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/compat/ie.js","\nimport { CONSTANTS } from './constants';\n\nexport let CONFIG = {\n    \n    ALLOW_POSTMESSAGE_POPUP: __TEST__ ? false : true,\n\n    LOG_LEVEL: 'info',\n\n    BRIDGE_TIMEOUT: 5000,\n    ACK_TIMEOUT: 1000,\n\n    LOG_TO_PAGE: false,\n    \n    MOCK_MODE: false,\n\n    ALLOWED_POST_MESSAGE_METHODS: {\n        [ CONSTANTS.SEND_STRATEGIES.POST_MESSAGE ]: true,\n        [ CONSTANTS.SEND_STRATEGIES.BRIDGE ]: true,\n        [ CONSTANTS.SEND_STRATEGIES.GLOBAL ]: true\n    }\n};\n\nif (window.location.href.indexOf(CONSTANTS.FILE_PROTOCOL) === 0) {\n    CONFIG.ALLOW_POSTMESSAGE_POPUP = true;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/conf/config.js","\nimport { CONSTANTS, POST_MESSAGE_NAMES_LIST } from '../../conf';\nimport { deserializeMethods, log, isWindowClosed, jsonParse, util } from '../../lib';\nimport { emulateIERestrictions } from '../../compat';\nimport { global } from '../../global';\n\nimport { RECEIVE_MESSAGE_TYPES } from './types';\n\nglobal.receivedMessages = global.receivedMessages || [];\n\nfunction parseMessage(message) {\n\n    try {\n        message = jsonParse(message);\n    } catch (err) {\n        return;\n    }\n\n    if (!message) {\n        return;\n    }\n\n    message = message[CONSTANTS.WINDOW_PROPS.POSTROBOT];\n\n    if (!message) {\n        return;\n    }\n\n    if (!message.type) {\n        return;\n    }\n\n    if (!RECEIVE_MESSAGE_TYPES[message.type]) {\n        return;\n    }\n\n    return message;\n}\n\n\nexport function receiveMessage(event) {\n\n    if (!window || window.closed) {\n        throw new Error(`Message recieved in closed window`);\n    }\n\n    try {\n        if (!event.source) {\n            return;\n        }\n    } catch (err) {\n        return;\n    }\n\n    let { source, origin, data } = event;\n\n    let message = parseMessage(data);\n\n    if (!message) {\n        return;\n    }\n\n    if (message.sourceDomain.indexOf(CONSTANTS.MOCK_PROTOCOL) === 0 || message.sourceDomain.indexOf(CONSTANTS.FILE_PROTOCOL) === 0) {\n        origin = message.sourceDomain;\n    }\n\n    if (global.receivedMessages.indexOf(message.id) === -1) {\n        global.clean.push(global.receivedMessages, message.id);\n    } else {\n        return;\n    }\n\n    let level;\n\n    if (POST_MESSAGE_NAMES_LIST.indexOf(message.name) !== -1 || message.type === CONSTANTS.POST_MESSAGE_TYPE.ACK) {\n        level = 'debug';\n    } else if (message.ack === 'error') {\n        level = 'error';\n    } else {\n        level = 'info';\n    }\n\n    log.logLevel(level, [ '\\n\\n\\t', '#receive', message.type.replace(/^postrobot_message_/, ''), '::', message.name, '::', origin, '\\n\\n', message ]);\n\n    if (isWindowClosed(source)) {\n        return log.debug(`Source window is closed - can not send ${message.type} ${message.name}`);\n    }\n\n    if (message.data) {\n        message.data = deserializeMethods(source, origin, message.data);\n    }\n\n    RECEIVE_MESSAGE_TYPES[message.type](source, origin, message);\n}\n\nexport function messageListener(event) {\n\n    try {\n        event.source // eslint-disable-line\n    } catch (err) {\n        return;\n    }\n\n    event = {\n        source: event.source || event.sourceElement,\n        origin: event.origin || event.originalEvent.origin,\n        data: event.data\n    };\n\n    try {\n        emulateIERestrictions(event.source, window);\n    } catch (err) {\n        return;\n    }\n\n    receiveMessage(event);\n}\n\nexport function listenForMessages() {\n    let listener = util.listen(window, 'message', messageListener);\n\n    global.clean.register('listener', () => {\n        listener.cancel();\n    });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/drivers/receive/index.js","\nimport { CONSTANTS } from '../../conf';\nimport { promise, log, isWindowClosed } from '../../lib';\n\nimport { sendMessage } from '../send';\nimport { listeners, getRequestListener } from '../listeners';\n\nfunction matchDomain(domain, origin) {\n\n    if (typeof domain === 'string') {\n        return domain === '*' || origin === domain;\n    }\n\n    if (Object.prototype.toString.call(domain) === '[object RegExp]') {\n        return origin.match(domain);\n    }\n\n    if (Array.isArray(domain)) {\n        return domain.indexOf(origin) !== -1;\n    }\n\n    return false;\n}\n\nexport let RECEIVE_MESSAGE_TYPES = {\n\n    [ CONSTANTS.POST_MESSAGE_TYPE.ACK ]: (source, origin, message) => {\n\n        let options = listeners.response[message.hash];\n\n        if (!options) {\n            throw new Error(`No handler found for post message ack for message: ${message.name} from ${origin} in ${window.location.protocol}//${window.location.host}${window.location.pathname}`);\n        }\n\n        if (!matchDomain(options.domain, origin)) {\n            throw new Error(`Ack origin ${origin} does not match domain ${options.domain}`);\n        }\n\n        options.ack = true;\n    },\n\n    [ CONSTANTS.POST_MESSAGE_TYPE.REQUEST ]: (source, origin, message) => {\n\n        let options = getRequestListener(message.name, source, origin);\n\n        function respond(data) {\n\n            if (message.fireAndForget || isWindowClosed(source)) {\n                return promise.Promise.resolve();\n            }\n\n            return sendMessage(source, {\n                target: message.originalSource,\n                hash: message.hash,\n                name: message.name,\n                ...data\n            }, origin);\n        }\n\n        return promise.Promise.all([\n\n            respond({\n                type: CONSTANTS.POST_MESSAGE_TYPE.ACK\n            }),\n\n            promise.run(() => {\n\n                if (!options) {\n                    throw new Error(`No handler found for post message: ${message.name} from ${origin} in ${window.location.protocol}//${window.location.host}${window.location.pathname}`);\n                }\n\n                if (!matchDomain(options.domain, origin)) {\n                    throw new Error(`Request origin ${origin} does not match domain ${options.domain}`);\n                }\n\n                let data = message.data;\n\n                return promise.deNodeify(options.handler, { source, origin, data });\n\n            }).then(data => {\n\n                return respond({\n                    type: CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,\n                    ack: CONSTANTS.POST_MESSAGE_ACK.SUCCESS,\n                    data\n                });\n\n            }, err => {\n\n                return respond({\n                    type: CONSTANTS.POST_MESSAGE_TYPE.RESPONSE,\n                    ack: CONSTANTS.POST_MESSAGE_ACK.ERROR,\n                    error: err.stack ? `${err.message}\\n${err.stack}` : err.toString()\n                });\n            })\n\n        ]).catch(err => {\n\n            if (options && options.handleError) {\n                return options.handleError(err);\n            } else {\n                log.error(err.stack || err.toString());\n            }\n        });\n    },\n\n    [ CONSTANTS.POST_MESSAGE_TYPE.RESPONSE ]: (source, origin, message) => {\n\n        let options = listeners.response[message.hash];\n\n        if (!options) {\n            throw new Error(`No handler found for post message response for message: ${message.name} from ${origin} in ${window.location.protocol}//${window.location.host}${window.location.pathname}`);\n        }\n\n        if (!matchDomain(options.domain, origin)) {\n            throw new Error(`Response origin ${origin} does not match domain ${options.domain}`);\n        }\n\n        delete listeners.response[message.hash];\n\n        if (message.ack === CONSTANTS.POST_MESSAGE_ACK.ERROR) {\n            return options.respond(new Error(message.error));\n        } else if (message.ack === CONSTANTS.POST_MESSAGE_ACK.SUCCESS) {\n            let data = message.data || message.response;\n\n            return options.respond(null, { source, origin, data });\n        }\n    }\n};\n\n\n// WEBPACK FOOTER //\n// ./src/drivers/receive/types.js","\nimport { CONSTANTS } from '../../conf';\nimport { isSameDomain, isSameTopWindow } from '../../lib';\nimport { emulateIERestrictions } from '../../compat';\nimport { sendBridgeMessage } from '../../bridge';\n\nexport let SEND_MESSAGE_STRATEGIES = {\n\n    [ CONSTANTS.SEND_STRATEGIES.POST_MESSAGE ](win, serializedMessage, domain) {\n\n        emulateIERestrictions(window, win);\n\n        if (domain && domain.indexOf(CONSTANTS.MOCK_PROTOCOL) === 0) {\n            domain = `${win.location.protocol}//${win.location.host}`;\n        }\n\n        if (domain && domain.indexOf(CONSTANTS.FILE_PROTOCOL) === 0) {\n            domain = `*`;\n        }\n\n        return win.postMessage(serializedMessage, domain);\n    },\n\n    [ CONSTANTS.SEND_STRATEGIES.BRIDGE ](win, serializedMessage, domain) {\n\n        if (isSameDomain(win)) {\n            throw new Error(`Post message through bridge disabled between same domain windows`);\n        }\n\n        if (isSameTopWindow(window, win) !== false) {\n            throw new Error(`Can only use bridge to communicate between two different windows, not between frames`);\n        }\n\n        return sendBridgeMessage(win, serializedMessage, domain);\n    },\n\n    [ CONSTANTS.SEND_STRATEGIES.GLOBAL ](win, serializedMessage, domain) {\n\n        if (!isSameDomain(win)) {\n            throw new Error(`Post message through global disabled between different domain windows`);\n        }\n\n        if (isSameTopWindow(window, win) !== false) {\n            throw new Error(`Can only use global to communicate between two different windows, not between frames`);\n        }\n\n        let foreignGlobal = win[CONSTANTS.WINDOW_PROPS.POSTROBOT];\n        \n        if (!foreignGlobal) {\n            throw new Error(`Can not find postRobot global on foreign window`);\n        }\n\n        return foreignGlobal.receiveMessage({\n            source: window,\n            origin: domain,\n            data: serializedMessage\n        });\n    }\n};\n\n\n// WEBPACK FOOTER //\n// ./src/drivers/send/strategies.js","\nimport { CONFIG, CONSTANTS } from '../conf';\nimport { sendMessage } from '../drivers';\nimport { global } from '../global';\nimport { util, promise, getAncestor, isAncestor, onWindowReady, isWindowClosed } from '../lib';\n\n\nexport function request(options) {\n\n    return promise.nodeify(new promise.Promise((resolve, reject) => {\n\n        if (!options.name) {\n            throw new Error('Expected options.name');\n        }\n\n        \n        if (CONFIG.MOCK_MODE) {\n            options.window = window;\n\n        } else if (typeof options.window === 'string') {\n            let el = document.getElementById(options.window);\n\n            if (!el) {\n                throw new Error(`Expected options.window ${options.window} to be a valid element id`);\n            }\n\n            if (el.tagName.toLowerCase() !== 'iframe') {\n                throw new Error(`Expected options.window ${options.window} to be an iframe`);\n            }\n\n            if (!el.contentWindow) {\n                throw new Error('Iframe must have contentWindow.  Make sure it has a src attribute and is in the DOM.');\n            }\n\n            options.window = el.contentWindow;\n\n            \n        } else if (options.window instanceof HTMLElement) {\n            \n            if (options.window.tagName.toLowerCase() !== 'iframe') {\n                throw new Error(`Expected options.window ${options.window} to be an iframe`);\n            }\n\n            if (!options.window.contentWindow) {\n                throw new Error('Iframe must have contentWindow.  Make sure it has a src attribute and is in the DOM.');\n            }\n            \n            options.window = options.window.contentWindow;\n        }\n\n        if (!options.window) {\n            throw new Error('Expected options.window to be a window object, iframe, or iframe element id.');\n        }\n\n        options.domain = options.domain || '*';\n\n        let hash = `${options.name}_${util.uniqueID()}`;\n        global.clean.setItem(global.listeners.response, hash, options);\n\n        if (isWindowClosed(options.window)) {\n            throw new Error('Target window is closed');\n        }\n\n        let hasResult = false;\n\n        options.respond = (err, result) => {\n            if (!err) {\n                hasResult = true;\n            }\n\n            return err ? reject(err) : resolve(result);\n        };\n\n        return promise.run(() => {\n\n            if (isAncestor(window, options.window)) {\n                return onWindowReady(options.window);\n            }\n\n        }).then(() => {\n\n            sendMessage(options.window, {\n                hash,\n                type: CONSTANTS.POST_MESSAGE_TYPE.REQUEST,\n                name: options.name,\n                data: options.data,\n                fireAndForget: options.fireAndForget\n            }, options.domain).catch(reject);\n\n            if (options.fireAndForget) {\n                return resolve();\n            }\n\n            let ackTimeout = util.intervalTimeout(CONFIG.ACK_TIMEOUT, 100, remaining => {\n\n                if (options.ack || isWindowClosed(options.window)) {\n                    return ackTimeout.cancel();\n                }\n\n                if (!remaining) {\n                    return reject(new Error(`No ack for postMessage ${options.name} in ${CONFIG.ACK_TIMEOUT}ms`));\n                }\n            });\n\n            if (options.timeout) {\n                let timeout = util.intervalTimeout(options.timeout, 100, remaining => {\n\n                    if (hasResult || isWindowClosed(options.window)) {\n                        return timeout.cancel();\n                    }\n\n                    if (!remaining) {\n                        return reject(new Error(`Post message response timed out after ${options.timeout} ms`));\n                    }\n\n                }, options.timeout);\n            }\n\n        }).catch(reject);\n\n    }), options.callback);\n}\n\nexport function send(window, name, data, options, callback) {\n\n    if (!callback) {\n        if (!options && typeof data === 'function') {\n            callback = data;\n            options = {};\n            data = {};\n        } else if (typeof options === 'function') {\n            callback = options;\n            options = {};\n        }\n    }\n\n    options = options || {};\n    options.window = window;\n    options.name = name;\n    options.data = data;\n    options.callback = callback;\n\n    return request(options);\n}\n\nexport function sendToParent(name, data, options, callback) {\n\n    let win = getAncestor();\n\n    if (!win) {\n        return new promise.Promise((resolve, reject) => reject(new Error('Window does not have a parent')));\n    }\n\n    return send(win, name, data, options, callback);\n}\n\nexport function client(options = {}) {\n\n    if (!options.window) {\n        throw new Error(`Expected options.window`);\n    }\n\n    return {\n        send(name, data, callback) {\n            return send(options.window, name, data, options, callback);\n        }\n    };\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/interface/client.js","\nimport { CONFIG, CONSTANTS } from '../conf';\nimport { messageListener } from '../drivers';\n\nexport function enableMockMode() {\n    CONFIG.MOCK_MODE = true;\n}\n\nexport function disableMockMode() {\n    CONFIG.MOCK_MODE = false;\n}\n\nexport { CONFIG, CONSTANTS } from '../conf';\n\nexport function disable() {\n    delete window[CONSTANTS.WINDOW_PROPS.POSTROBOT];\n    window.removeEventListener('message', messageListener);\n}\n\n\n// WEBPACK FOOTER //\n// ./src/interface/config.js","\nimport { CONFIG } from '../conf';\nimport { util, promise, isWindowClosed } from '../lib';\nimport { addRequestListener, removeRequestListener } from '../drivers';\n\nexport function listen(options) {\n\n    if (!options.name) {\n        throw new Error('Expected options.name');\n    }\n\n    options.handler = options.handler || util.noop;\n\n    options.errorHandler = options.errorHandler || function(err) {\n        throw err;\n    };\n\n    if (options.once) {\n        let handler = options.handler;\n        options.handler = util.once(function() {\n            removeRequestListener(options);\n            return handler.apply(this, arguments);\n        });\n    }\n\n    let override = options.override || CONFIG.MOCK_MODE;\n\n    if (options.source) {\n        options.window = options.source;\n    }\n\n    options.domain = options.domain || '*';\n\n    addRequestListener(options.name, options.window, options.domain, options, override);\n\n    options.handleError = err => {\n        // removeRequestListener(options);\n        options.errorHandler(err);\n    };\n\n    if (options.window && options.errorOnClose) {\n        let interval = util.safeInterval(() => {\n            if (isWindowClosed(options.window)) {\n                interval.cancel();\n                options.handleError(new Error('Post message target window is closed'));\n            }\n        }, 50);\n    }\n\n    return {\n        cancel() {\n            removeRequestListener(options);\n        }\n    };\n}\n\nexport function on(name, options, handler, errorHandler) {\n\n    if (typeof options === 'function') {\n        errorHandler = handler;\n        handler = options;\n        options = {};\n    }\n\n    options = options || {};\n\n    options.name = name;\n    options.handler = handler || options.handler;\n    options.errorHandler = errorHandler || options.errorHandler;\n\n    return listen(options);\n}\n\nexport function once(name, options, handler, errorHandler) {\n\n    if (typeof options === 'function') {\n        errorHandler = handler;\n        handler = options;\n        options = {};\n    }\n\n    options = options || {};\n\n    options.name = name;\n    options.handler = handler || options.handler;\n    options.errorHandler = errorHandler || options.errorHandler;\n    options.once = true;\n\n    let prom = new promise.Promise((resolve, reject) => {\n        options.handler = options.handler || (event => resolve(event));\n        options.errorHandler = options.errorHandler || reject;\n    });\n\n    let myListener = listen(options);\n\n    util.extend(prom, myListener);\n\n    return prom;\n}\n\nexport function listener(options = {}) {\n\n    return {\n        on(name, handler, errorHandler) {\n            return on(name, options, handler, errorHandler);\n        }\n    };\n}\n\n\n// WEBPACK FOOTER //\n// ./src/interface/server.js","\nimport { CONSTANTS } from '../conf';\nimport { util } from './util';\nimport { on, send } from '../interface';\nimport { log } from './log';\nimport { promise } from './promise';\nimport { global } from '../global';\n\nglobal.methods = global.methods || {};\n\nexport let listenForMethods = util.once(() => {\n    on(CONSTANTS.POST_MESSAGE_NAMES.METHOD, { window: '*', origin: '*' }, ({ source, origin, data }) => {\n\n        let meth = global.methods[data.id];\n\n        if (!meth) {\n            throw new Error(`Could not find method with id: ${data.id}`);\n        }\n\n        if (meth.destination !== source) {\n            throw new Error(`Method window does not match`);\n        }\n\n        if (meth.domain && meth.domain !== '*' && origin !== meth.domain) {\n            throw new Error(`Method domain ${meth.domain} does not match origin ${origin}`);\n        }\n\n        log.debug('Call local method', data.name, data.args);\n\n        return promise.run(() => {\n            return meth.method.apply({ source, origin, data }, data.args);\n\n        }).then(result => {\n\n            return {\n                result,\n                id: data.id,\n                name: data.name\n            };\n        });\n    });\n});\n\nfunction isSerialized(item, type) {\n    return typeof item === 'object' && item !== null && item.__type__ === type;\n}\n\nexport function serializeMethod(destination, domain, method, name) {\n\n    let id = util.uniqueID();\n\n    global.clean.setItem(global.methods, id, { destination, domain, method });\n\n    return {\n        __type__: CONSTANTS.SERIALIZATION_TYPES.METHOD,\n        __id__: id,\n        __name__: name\n    };\n}\n\nfunction serializeError(err) {\n    return {\n        __type__: CONSTANTS.SERIALIZATION_TYPES.ERROR,\n        __message__: err.stack || err.message || err.toString()\n    };\n}\n\nexport function serializeMethods(destination, domain, obj) {\n\n    return util.replaceObject({ obj }, (item, key) => {\n        if (typeof item === 'function') {\n            return serializeMethod(destination, domain, item, key);\n        }\n\n        if (item instanceof Error) {\n            return serializeError(item);\n        }\n    }).obj;\n}\n\nexport function deserializeMethod(source, origin, obj) {\n\n    function wrapper() {\n        let args = Array.prototype.slice.call(arguments);\n        log.debug('Call foreign method', obj.__name__, args);\n        return send(source, CONSTANTS.POST_MESSAGE_NAMES.METHOD, {\n            id: obj.__id__,\n            name: obj.__name__,\n            args\n\n        }, { domain: origin }).then(({ data }) => {\n\n            log.debug('Got foreign method result', obj.__name__, data.result);\n            return data.result;\n        }, err => {\n            log.debug('Got foreign method error', err.stack || err.toString());\n            throw err;\n        });\n    }\n\n    wrapper.__name__ = obj.__name__;\n    wrapper.source = source;\n    wrapper.origin = origin;\n\n    return wrapper;\n}\n\nexport function deserializeError(source, origin, obj) {\n    return new Error(obj.__message__);\n}\n\nexport function deserializeMethods(source, origin, obj) {\n\n    return util.replaceObject({ obj }, (item, key) => {\n\n        if (isSerialized(item, CONSTANTS.SERIALIZATION_TYPES.METHOD)) {\n            return deserializeMethod(source, origin, item);\n        }\n\n        if (isSerialized(item, CONSTANTS.SERIALIZATION_TYPES.ERROR)) {\n            return deserializeError(source, origin, item);\n        }\n\n    }).obj;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/methods.js","\nimport { CONSTANTS } from '../conf';\nimport { getAncestor } from './windows';\nimport { on, send } from '../interface';\nimport { log } from './log';\nimport { SyncPromise as Promise } from 'sync-browser-mocks/src/promise';\nimport { global } from '../global';\n\nglobal.readyPromises = global.readyPromises || [];\n\nexport function initOnReady() {\n\n    on(CONSTANTS.POST_MESSAGE_NAMES.READY, { window: '*', domain: '*' }, event => {\n\n        for (let item of global.readyPromises) {\n            if (item.win === event.source) {\n                item.promise.resolve(event);\n                return;\n            }\n        }\n\n        global.clean.push(global.readyPromises, {\n            win: event.source,\n            promise: new Promise().resolve(event)\n        });\n    });\n\n    let parent = getAncestor();\n\n    if (parent) {\n        send(parent, CONSTANTS.POST_MESSAGE_NAMES.READY, {}, { domain: '*' }).catch(err => {\n            log.debug(err.stack || err.toString());\n        });\n    }\n}\n\nexport function onWindowReady(win, timeout = 5000, name = 'Window') {\n\n    for (let item of global.readyPromises) {\n        if (item.win === win) {\n            return item.promise;\n        }\n    }\n\n    let promise = new Promise();\n\n    global.clean.push(global.readyPromises, { win, promise });\n\n    setTimeout(() => promise.reject(new Error(`${name} did not load after ${timeout}ms`)), timeout);\n\n    return promise;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/ready.js","\nimport { initOnReady, listenForMethods } from './lib';\nimport { listenForMessages } from './drivers';\nimport { global } from './global';\nimport { openTunnelToOpener } from './bridge';\n\nexport function init() {\n\n    if (!global.initialized) {\n        listenForMessages();\n        openTunnelToOpener();\n        initOnReady();\n        listenForMethods();\n    }\n\n    global.initialized = true;\n}\n\ninit();\n\nexport function reset() {\n    return global.clean.all().then(() => {\n        global.initialized = false;\n        return init();\n    });\n}\n\nexport * from './interface';\nexport { Promise } from './lib';\n\nexport default module.exports;\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js"],"sourceRoot":""}